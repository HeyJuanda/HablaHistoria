<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="google-adsense-account" content="ca-pub-9925435155682261">
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9925435155682261"
     crossorigin="anonymous"></script>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Blog ‚Ä¢ HablaHistoria</title>
  <link rel="icon" href="logo.jpg" type="image/x-icon">
  <style>
    :root {
      --bg:#ffffff; 
      --card:#fffaf0; 
      --input:#ffffff; 
      --border:#ffbf69; 
      --text:#000000; 
      --primary:#ff9f1c;
    }
    body { margin:0; font-family:system-ui,sans-serif; background:var(--bg); color:var(--text); }
.btn.icon, 
.btn.ghost.icon {
  border: none !important;     
  background: transparent !important; /* sin fondo */
  color: #fff !important;             /* fuerza blanco */
  box-shadow: none !important;
}

.btn.icon svg {
  width: 22px;
  height: 22px;
  fill: #fff !important; /* SVG blanco s√≥lido */
}
header {
  display: grid;
  grid-template-columns: 1fr auto 1fr; /* tres columnas equilibradas */
  align-items: center;
  padding: 14px 16px;
  background: #ff9f1c;
  color: #fff;
  border-bottom: 2px solid #e67e00;
  position: sticky;
  top: 0;
  z-index: 10;
}

header h1 { 
  margin: 0;
  display: flex; 
  align-items: center; 
  justify-self: start; /* izquierda */
}

header h1 img {
  width: 38px;
  height: 38px;
  border-radius: 50%;
  object-fit: cover;
}

.logo {
  justify-self: center; /* centro exacto */
  text-align: center;
}
.logo img {
  width: 40px;
  height: auto;
  opacity: 85%;
  cursor: pointer;
}

header > div:last-child {
  justify-self: end; /* derecha */
  display: flex;
  gap: 8px;
}

    .btn {
      background:var(--primary); color:#ffffff; border:none;
      border-radius:10px; padding:10px 14px; font-weight:600; cursor:pointer
    }
    .btn.ghost {
      background:transparent; border:1px solid var(--border); color:#e67e00
    }
    .container { max-width:900px; max-height: 400px; margin:24px auto; padding:0 16px}
    .card { background:var(--card); border:1px solid var(--border); border-radius:16px; padding:16px }
    .stack { display:grid; gap:12px }
    input, textarea, select {
      width: 95%; padding:12px; border-radius:12px; margin-bottom: 4px;
      border:1px solid var(--border); background:var(--input); color:#000; outline:none
    }
    textarea { min-height:110px; resize:vertical }
    .grid { display:grid; gap:12px }
    @media(min-width:860px) { .grid.cols-2 { grid-template-columns:1fr 1fr }
    .logo {
      text-align:center;
    }
    .logo img {
      width:40px;
      height:auto;
    } }
    .post {
      background:#fff; border:1px solid var(--border);
      border-radius:12px; padding:14px; transition:all 0.3s ease-in-out;
      position:relative;
    }
    .post h3 { margin:0 0 6px 0; color:#e67e00; cursor:pointer }
    .meta { opacity:.8; font-size:12px; margin-bottom:6px }
    .media img, .media video, .media audio {
      max-width:100%; border-radius:10px; margin-top:8px; display:block
    }
    .tag {
      display:inline-block; background:#ffefcc;
      border:1px solid #ffbf69; padding:4px 8px;
      border-radius:999px; font-size:12px; margin-right:6px; margin-bottom:1.4px
    }
    .muted { opacity:.7 }
    .empty {
      border:1px dashed var(--border); border-radius:12px;
      padding:18px; text-align:center
    }
    .content-collapsed {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s ease;
    }
    .content-expanded {
      max-height: 1000px;
      transition: max-height 0.5s ease;
    }
    .toggle-content-btn {
      background: none;
      border: none;
      color: var(--primary);
      font-weight: 600;
      cursor: pointer;
      padding: 6px 0;
      font-size: 14px;
      margin-top: 8px;
      text-align: left;
    }
    /* Estilos para previews */
    .link-preview {
      border: 1px solid var(--border);
      padding: 8px;
      border-radius: 10px;
      margin-top: 6px;
      background: #fffef8;
    }
    .link-preview img {
      max-width: 100%;
      border-radius: 8px;
      margin-bottom: 6px;
    }
    .link-preview a {
      color: var(--primary);
      font-weight: 600;
      text-decoration: none;
      word-break: break-all;
    }
    /* Comentarios */
    .comments { margin-top: 12px; padding-top: 10px; border-top: 1px solid var(--border); }
    .comment { padding: 4px 0; font-size: 14px; }
    .comments-list { margin-bottom: 8px; }

    /* === Uploader Cloudinary === */
    .uploader { border:1px dashed var(--border); max-width: 95%; background:#fff; border-radius:12px; padding:12px }
    .uploader small { display:block; margin-top:6px }
    .uploads { display:grid; gap:8px; margin-top:8px }
    .upload-item { font-size:14px; background:#fffef8; border:1px solid var(--border); border-radius:8px; padding:8px }
    progress { width:100%; height:10px }
    
  </style>
</head>
<body>
<header>
  <h1> <img src="logo.jpg"> </h1>
  <div class="logo">
  <img src="svg/m.svg" alt="Hug-oh Logo" onclick="location.href='https://hug-oh.com/'">
  </div>
<div style="display:flex;gap:8px">
  <!-- YouTube -->
  <button
    onclick="location.href='https://www.youtube.com/@hablahistoria?sub_confirmation=1'"
    class="btn icon"
    title="YouTube"
    aria-label="YouTube"
  >
    <!-- √≠cono YouTube -->
    <svg viewBox="0 0 24 24" aria-hidden="true">
      <path d="M23.5 6.2a4 4 0 0 0-2.8-2.8C18.7 3 12 3 12 3s-6.7 0-8.7.4A4 4 0 0 0 .5 6.2 41 41 0 0 0 0 12a41 41 0 0 0 .5 5.8 4 4 0 0 0 2.8 2.8C5.3 21 12 21 12 21s6.7 0 8.7-.4a4 4 0 0 0 2.8-2.8A41 41 0 0 0 24 12a41 41 0 0 0-.5-5.8zM9.75 15.5v-7l6 3.5-6 3.5z"/>
    </svg>
  </button>

  <!-- Chats -->
  <button onclick="location.href='chat.html'" class="btn ghost icon" title="Chats" aria-label="Chats">
    <!-- √≠cono Chats (burbujas de mensaje) -->
    <svg viewBox="0 0 24 24" aria-hidden="true">
      <path d="M4 4h16a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2H7l-4 4V6a2 2 0 0 1 2-2z"/>
    </svg>
  </button>

  <!-- Cerrar sesi√≥n -->
  <button id="btnLogout" class="btn ghost icon" title="Cerrar sesi√≥n" aria-label="Cerrar sesi√≥n">
    <!-- √≠cono Logout -->
    <svg viewBox="0 0 24 24" aria-hidden="true">
      <path d="M10 4a1 1 0 0 0-1 1v3a1 1 0 1 0 2 0V6h6v12h-6v-2a1 1 0 1 0-2 0v3a1 1 0 0 0 1 1h8a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2h-8z"/>
      <path d="M11.7 12.7a1 1 0 0 0 0-1.4l-3-3a1 1 0 1 0-1.4 1.4L8.6 11H3a1 1 0 1 0 0 2h5.6l-1.3 1.3a1 1 0 0 0 1.4 1.4l3-3z"/>
    </svg>
  </button>
</div>
</header>

<div class="container stack">
  <!-- Panel Docente -->
  <div id="teacherPanel" class="card stack" style="display:none">
    <h2 style="margin:0;color:#e67e00">Publicar (docente)</h2>
    <div class="grid cols-2">
      <input id="postTitle" placeholder="T√≠tulo" />
      <select id="postGrades" multiple>
        <option value="7A">7¬∞ "A"</option>
        <option value="7B">7¬∞ "B"</option>
        <option value="8A">8¬∞ "A"</option>
        <option value="8B">8¬∞ "B"</option>
        <option value="9A">9¬∞ "A"</option>
        <option value="9B">9¬∞ "B"</option> 
        <option value="All">All</option>
      </select>
    </div>
    <textarea id="postContent" placeholder="Contenido..."></textarea>

    <!-- === Subida de archivos con Cloudinary === -->
    <div class="uploader">
      <strong>Subir archivos (im√°genes / video / audio)</strong>
      <hr>
      <div class="grid cols-2" style="align-items:center">
    <!-- Input oculto -->
       <input id="fileInput" type="file" multiple accept="image/*,video/*,audio/*" hidden />
    <!-- Bot√≥n para abrir el input -->
       <button class="btn" id="btnSelectFile">üìÇ Seleccionar archivo</button>
    <!-- Bot√≥n para subir -->
       <button class="btn" id="btnUpload">‚¨Ü Subir</button>
      </div>
      <div id="uploads" class="uploads"></div>
    </div>


    <div class="stack">
      <label for="postFiles" class="muted">Enlaces ‚Äî admite im√°genes, video o audio. (Separalas por linea)</label>
      <textarea id="postFiles" placeholder="https://...jpg\nhttps://...mp4\nhttps://...mp3\nhttps://...link"></textarea>
    </div>
    <div>
      <button class="btn" id="btnPublish">Publicar</button>
    </div>
  </div>

  <!-- Lista de publicaciones -->
  <div id="postsWrap" class="stack">
    <div id="infoBox" class="empty muted">Cargando publicaciones‚Ä¶</div>
    <div id="postsList" class="stack"></div>
  </div>
</div>

<script type="module">
  import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js';
  import { getAuth, onAuthStateChanged, signOut } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js';
  import { getFirestore, doc, getDoc, collection, addDoc, getDocs, query, where, orderBy, serverTimestamp, deleteDoc } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js';

  const firebaseConfig = {
    apiKey: "AIzaSyB0MfByHYHikrECUDVM2QenIsLiLmoS_FM",
    authDomain: "hablahistoria-802fd.firebaseapp.com",
    projectId: "hablahistoria-802fd",
    storageBucket: "hablahistoria-802fd.appspot.com",
    messagingSenderId: "322467465610",
    appId: "1:322467465610:web:98da756bc6d80f440a6073",
  };

  const TEACHER_EMAILS = ["hey.junda@gmail.com", "yesenia.lisseth.flores@clases.edu.sv",];
  const LINK_API_KEY = "a30ad1652095af5a53163f76aec86711"; // üëâ consigue tu API key gratis en linkpreview.net

  // === Configuraci√≥n Cloudinary (REEMPLAZA ESTOS VALORES) ===
  // 1) Crea un Upload Preset SIN firmar (unsigned) en tu cuenta Cloudinary.
  // 2) Coloca aqu√≠ tu cloud name y el nombre del preset.
  const CLOUDINARY_CLOUD_NAME = "dzkddfq8b"; // p.ej. "demo"
  const CLOUDINARY_UPLOAD_PRESET = "unsigned_default"; // p.ej. "unsigned_default"
  // (Opcional) carpeta destino dentro de Cloudinary
  const CLOUDINARY_FOLDER = "hablahistoria";

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  const teacherPanel = document.getElementById('teacherPanel');
  const postsList = document.getElementById('postsList');
  const infoBox = document.getElementById('infoBox');

  // Uploader refs
  const fileInput = document.getElementById('fileInput');
  const btnUpload = document.getElementById('btnUpload');
  const btnSelectFile = document.getElementById('btnSelectFile');
  // Bot√≥n "Seleccionar archivo" abre el input oculto
  btnSelectFile?.addEventListener("click", () => {
   fileInput.click();
  });

// Mostrar el nombre del archivo seleccionado en el bot√≥n
  fileInput?.addEventListener("change", (e) => {
   if (e.target.files.length > 0) {
    btnSelectFile.textContent = "üìÇ " + e.target.files[0].name;
   } else {
     btnSelectFile.textContent = "üìÇ Seleccionar archivo";
   }
  });

  const uploadsWrap = document.getElementById('uploads');
  const postFilesTA = document.getElementById('postFiles');

  let currentUser = null;
  let userGrade = null;

  function parseUrls(raw) {
    return raw.split('\n').map(s => s.trim()).filter(Boolean);
  }

  // === Cloudinary: subida de archivos (unsigned) ===
  async function uploadToCloudinary(file) {
    const endpoint = `https://api.cloudinary.com/v1_1/${CLOUDINARY_CLOUD_NAME}/auto/upload`;
    const fd = new FormData();
    fd.append('file', file);
    fd.append('upload_preset', CLOUDINARY_UPLOAD_PRESET);
    if (CLOUDINARY_FOLDER) fd.append('folder', CLOUDINARY_FOLDER);

    // UI item
    const item = document.createElement('div');
    item.className = 'upload-item';
    item.innerHTML = `<strong>${file.name}</strong><br><progress value="0" max="100"></progress><span class="muted"> Subiendo‚Ä¶</span>`;
    const progressEl = item.querySelector('progress');
    const statusEl = item.querySelector('span');
    uploadsWrap.appendChild(item);

    try {
      // fetch no expone progreso nativo; usamos xhr para mostrar avance real
      const res = await new Promise((resolve, reject) => {
        const xhr = new XMLHttpRequest();
        xhr.open('POST', endpoint);
        xhr.onload = () => (xhr.status >= 200 && xhr.status < 300) ? resolve(xhr) : reject(new Error(xhr.responseText));
        xhr.onerror = () => reject(new Error('Network error'));
        xhr.upload.onprogress = (e) => {
          if (e.lengthComputable) progressEl.value = Math.round((e.loaded / e.total) * 100);
        };
        xhr.send(fd);
      });

      const data = JSON.parse(res.responseText);
      statusEl.textContent = ' Listo ‚úÖ';
      progressEl.value = 100;

      // Agregar URL al textarea (nueva l√≠nea)
      const url = data.secure_url;
      postFilesTA.value = (postFilesTA.value ? postFilesTA.value + '\n' : '') + url;

      // Vista previa r√°pida si es imagen
      if (data.resource_type === 'image') {
        const img = document.createElement('img');
        img.src = data.secure_url;
        img.alt = file.name;
        img.style.maxWidth = '160px';
        img.style.borderRadius = '8px';
        img.style.display = 'block';
        img.style.marginTop = '6px';
        item.appendChild(img);
      }

      return data;
    } catch (err) {
      statusEl.textContent = ' Error ‚ùå';
      console.error('Cloudinary upload error:', err);
      alert('No se pudo subir: ' + file.name);
      throw err;
    }
  }

  btnUpload?.addEventListener('click', async () => {
    const files = Array.from(fileInput.files || []);
    if (!files.length) {
      alert('Selecciona al menos un archivo.');
      return;
    }

    if (!CLOUDINARY_CLOUD_NAME || !CLOUDINARY_UPLOAD_PRESET || CLOUDINARY_CLOUD_NAME.includes('tu_')) {
      alert('Configura CLOUDINARY_CLOUD_NAME y CLOUDINARY_UPLOAD_PRESET en el c√≥digo.');
      return;
    }

    for (const f of files) {
      await uploadToCloudinary(f);
    }

    // Limpia el input tras subir
    fileInput.value = '';
  });

  // Previsualizaci√≥n de links con API externa
  async function renderMedia(url) {
    const u = url.toLowerCase();
    if (u.match(/\.(jpg|jpeg|png|gif|webp)$/)) {
      return `<img src="${url}" alt="Imagen relacionada" />`;
    }
    if (u.match(/\.(mp4|webm|ogg)$/)) {
      return `<video controls src="${url}"></video>`;
    }
    if (u.match(/\.(mp3|wav|ogg)$/)) {
      return `<audio controls src="${url}"></audio>`;
    }

    // Fetch a API LinkPreview
    try {
      const res = await fetch(`https://api.linkpreview.net/?key=${LINK_API_KEY}&q=${encodeURIComponent(url)}`);
      const data = await res.json();
      return `
        <div class="link-preview">
          ${data.image ? `<img src="${data.image}" alt="preview"/>` : ""}
          <a href="${data.url}" target="_blank">${data.title || url}</a>
          <p>${data.description || ""}</p>
        </div>`;
    } catch (e) {
      return `<div class="link-preview"><a href="${url}" target="_blank">${url}</a></div>`;
    }
  }

  function fmtDate(d) {
    try {
      const date = d?.toDate ? d.toDate() : new Date(d);
      return date.toLocaleString();
    } catch {
      return "";
    }
  }

onAuthStateChanged(auth, async (user) => {
  if (!user) {
    // Mostrar modal solo si no hay sesi√≥n activa
    const modal = document.getElementById("guestModal");
    const btnAnon = document.getElementById("btnAnon");
    const btnGoLogin = document.getElementById("btnGoLogin");

    if (modal && btnAnon && btnGoLogin) {
      modal.style.display = "flex"; // Mostrar modal

      btnAnon.onclick = async () => {
        // Sesi√≥n "an√≥nima" solo en frontend
        currentUser = { email: "An√≥nimo", uid: "anon" };
        userGrade = "All"; // Invitado ve solo p√∫blicas
        modal.style.display = "none"; // Ocultar modal tras elegir an√≥nimo
        await loadPosts();
      };

      btnGoLogin.onclick = () => {
        location.href = "login.html";
      };
    }
    return; // Salir, no cargar posts hasta elegir
  }

  // Usuario autenticado ‚Üí ocultar modal si estaba abierto
  const modal = document.getElementById("guestModal");
  if (modal) modal.style.display = "none";

  currentUser = user;
  if (TEACHER_EMAILS.includes(user.email)) teacherPanel.style.display = 'block';
  userGrade = await getUserGrade(user.uid) || localStorage.getItem('gradoUsuario');
  await loadPosts();
});



  async function getUserGrade(uid) {
    try {
      const snap = await getDoc(doc(db, "usuarios", uid));
      return snap.exists() ? snap.data().grado : null;
    } catch {
      return null;
    }
  }

  document.getElementById('btnPublish')?.addEventListener('click', async () => {
    const title = document.getElementById('postTitle').value.trim();
    const content = document.getElementById('postContent').value.trim();
    const files = parseUrls(document.getElementById('postFiles').value);
    const gradesSel = Array.from(document.getElementById('postGrades').selectedOptions).map(o => o.value);
    if (!title || !content || !gradesSel.length) {
      alert("Completa todos los campos.");
      return;
    }
    try {
      await addDoc(collection(db, "posts"), {
        title,
        content,
        allowedGrades: gradesSel,
        files,
        authorUid: currentUser.uid,
        authorEmail: currentUser.email,
        createdAt: serverTimestamp()
      });
      document.getElementById('postTitle').value = "";
      document.getElementById('postContent').value = "";
      document.getElementById('postFiles').value = "";
      Array.from(document.getElementById('postGrades').options).forEach(o => o.selected = false);
      uploadsWrap.innerHTML = '';
      await loadPosts();
      alert("Publicado ‚úÖ");
    } catch (err) {
      console.error(err);
      alert("No se pudo publicar.");
    }
  });

const ads = [
  { img: "add/add.png", url: "https://hug-oh.com/" },
  { img: "add/add2.png", url: "https://hug-oh.com/" },
  { img: "add/add31.png", url: "https://hug-oh.com/" },
  { img: "add/add4.png", url: "https://www.youtube.com/@hablahistoria?sub_confirmation=1" }
];
// Funci√≥n para obtener anuncio aleatorio
async function loadPosts() {
  postsList.innerHTML = "";
  infoBox.style.display = 'block';
  infoBox.textContent = "Cargando‚Ä¶";

  try {
    let snap;

    // Invitados: solo publicaciones p√∫blicas
    if (!currentUser || currentUser.email === "an√≥nimo") {
      snap = await getDocs(query(
        collection(db, "posts"),
        where("allowedGrades", "array-contains", "All")
      ));
    }
    // Docentes: todo
    else if (TEACHER_EMAILS.includes(currentUser.email)) {
      snap = await getDocs(query(
        collection(db, "posts"),
        orderBy("createdAt", "desc")
      ));
    }
    // Estudiantes: solo su grado
    else {
      if (!userGrade) {
        infoBox.textContent = "No encontramos tu grado.";
        return;
      }
      snap = await getDocs(query(
        collection(db, "posts"),
        where("allowedGrades", "array-contains", userGrade)
      ));
    }

    const posts = [];
    snap.forEach(d => posts.push({ id: d.id, ...d.data() }));
    posts.sort((a, b) => (b.createdAt?.seconds || 0) - (a.createdAt?.seconds || 0));
    infoBox.style.display = posts.length ? 'none' : 'block';
    infoBox.textContent = posts.length ? "" : "No hay publicaciones.";

    let count = 0;

    // Crear posts
    for (const p of posts) {
      const el = document.createElement('div');
      el.className = "post";

      // --- Contenido ---
      const toggle = document.createElement('h3');
      toggle.textContent = p.title;
      toggle.style.cursor = "pointer";

      const contentDiv = document.createElement('div');
      contentDiv.className = "content-collapsed";
      const mediaHtmls = await Promise.all((p.files || []).map(renderMedia));
      contentDiv.innerHTML = `
        <p>${(p.content || "").replace(/\n/g, "<br>")}</p>
        <div class="media">${mediaHtmls.join("")}</div>`;

      const toggleContentBtn = document.createElement('button');
      toggleContentBtn.className = "toggle-content-btn";
      toggleContentBtn.textContent = "Mostrar";
      toggleContentBtn.onclick = () => {
        const isCollapsed = contentDiv.classList.contains("content-collapsed");
        contentDiv.classList.toggle("content-collapsed", !isCollapsed);
        contentDiv.classList.toggle("content-expanded", isCollapsed);
        toggleContentBtn.textContent = isCollapsed ? "Ocultar" : "Mostrar";
      };

      const meta = document.createElement('div');
      meta.className = "meta muted";
      meta.innerHTML = `${p.authorEmail || ""} ‚Ä¢ ${fmtDate(p.createdAt)}<br>
        ${(p.allowedGrades || []).map(g => `<span class="tag">${g}</span>`).join(" ")}`;

      el.appendChild(toggle);
      el.appendChild(meta);
      el.appendChild(toggleContentBtn);
      el.appendChild(contentDiv);

      // --- Comentarios ---
      const commentsDiv = document.createElement("div");
      commentsDiv.className = "comments";
      const commentsList = document.createElement("div");
      commentsList.className = "comments-list";
      commentsDiv.appendChild(commentsList);

      const commentInput = document.createElement("input");
      commentInput.placeholder = "Escribe un comentario...";
      commentInput.style.width = "80%";

      const commentBtn = document.createElement("button");
      commentBtn.textContent = "Responder";
      commentBtn.className = "btn";
      commentBtn.style.marginLeft = "6px";

      commentBtn.onclick = async () => {
        const text = commentInput.value.trim();
        if (!text) return;
        try {
          await addDoc(collection(db, "posts", p.id, "comments"), {
            text,
            author: currentUser.email,
            createdAt: serverTimestamp()
          });
          commentInput.value = "";
          await loadComments(p.id, commentsList);
        } catch (err) {
          console.error(err);
          alert("No se pudo comentar.");
        }
      };

      commentsDiv.appendChild(commentInput);
      commentsDiv.appendChild(commentBtn);
      el.appendChild(commentsDiv);

      await loadComments(p.id, commentsList);

      // --- Bot√≥n eliminar solo para docentes ---
      if (TEACHER_EMAILS.includes(currentUser.email)) {
        const deleteBtn = document.createElement("button");
        deleteBtn.textContent = "üóë Eliminar";
        deleteBtn.className = "btn ghost";
        deleteBtn.style.marginTop = "10px";
        deleteBtn.onclick = async () => {
          const confirmDelete = confirm(`¬øEliminar publicaci√≥n: "${p.title}"?`);
          if (!confirmDelete) return;
          try {
            await deleteDoc(doc(db, "posts", p.id));
            await loadPosts();
            alert("Publicaci√≥n eliminada ‚úÖ");
          } catch (err) {
            console.error(err);
            alert("Error al eliminar.");
          }
        };
        el.appendChild(deleteBtn);
      }

      postsList.appendChild(el);
      count++;
    }

    // === ANUNCIOS DIN√ÅMICOS ===
    // Crear 2 contenedores de anuncios y mostrar anuncios iniciales
    const adContainers = [];
    for (let i = 0; i < 2; i++) {
      const adDiv = document.createElement('div');
      adDiv.className = "ad";

      const ad = ads[Math.floor(Math.random() * ads.length)];
      adDiv.innerHTML = `
        <a href="${ad.url}" target="_blank">
          <img src="${ad.img}" alt="Publicidad" style="max-width:100%; border-radius:12px; margin:12px 0;">
        </a>`;

      postsList.appendChild(adDiv);
      adContainers.push(adDiv);
    }

    // Cambiar anuncios cada 10 segundos
    setInterval(() => {
      adContainers.forEach(adDiv => {
        const ad = ads[Math.floor(Math.random() * ads.length)];
        adDiv.innerHTML = `
          <a href="${ad.url}" target="_blank">
            <img src="${ad.img}" alt="Publicidad" style="max-width:100%; border-radius:12px; margin:12px 0;">
          </a>`;
      });
    }, 10000);

  } catch (err) {
    console.error(err);
    infoBox.textContent = "Error cargando publicaciones.";
  }
}

  async function loadComments(postId, container) {
    container.innerHTML = "Cargando comentarios...";
    try {
      const snap = await getDocs(query(
        collection(db, "posts", postId, "comments"),
        orderBy("createdAt", "asc")
      ));
      if (snap.empty) {
        container.innerHTML = "<p class='muted'>Sin comentarios</p>";
        return;
      }
      container.innerHTML = "";
      snap.forEach(d => {
        const c = d.data();
        const div = document.createElement("div");
        div.className = "comment";
        div.innerHTML = `<strong>${c.author}</strong>: ${c.text}`;
        container.appendChild(div);
      });
    } catch (err) {
      console.error(err);
      container.innerHTML = "<p class='muted'>Error cargando comentarios</p>";
    }
  }

  document.getElementById('btnLogout').addEventListener('click', async () => {
    await signOut(auth);
    location.href = "login.html";
  });
</script>
<!-- Modal invitado -->
<!-- Modal para invitados -->
<div id="guestModal" class="modal">
  <div class="modal-content">
    <h2>Bienvenido üëã</h2>
    <p>Puedes entrar como <strong>an√≥nimo</strong> o ir al <strong>login</strong>. Si seleccionas an√≥nimo no podras ver los post de los grados ni comentar.</p>
    <div style="margin-top:15px; display:flex; gap:10px; justify-content:center;">
      <button id="btnAnon" class="btn">Entrar como An√≥nimo</button>
      <button id="btnGoLogin" class="btn ghost">Ir al Login</button>
    </div>
  </div>
</div>

<style>
  .modal { display:none; position:fixed; z-index:1000; inset:0;
           background:rgba(0,0,0,.5); display:flex; align-items:center; justify-content:center; }
  .modal-content { background:#fff; padding:20px; border-radius:12px; max-width:420px; width:90%;
                   text-align:center; box-shadow:0 10px 30px rgba(0,0,0,.25) }
</style>
</body>
</html>

















